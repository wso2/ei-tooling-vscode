/**
 * Copyright (c) 2023, WSO2 LLC. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 *
 */

import React, { useState } from "react";
import { Circle } from "@wso2-ei/low-code-diagram";
import { getComponent } from "../../util";
import { WorkerLine } from "../worker-line";
import { CallTemplateMediatorProperty } from "../PropertyPanels/index";
import {
  DiagramEditorLangClientInterface,
  GetCompletionResponse,
} from "@wso2-ei/low-code-editor-commons";

interface SquareProps {
  model: Circle;
  getDiagramEditorLangClient?: () => Promise<DiagramEditorLangClientInterface>;
  textDocumentUrl: string;
  textDocumentFsPath: string;
  items: GetCompletionResponse[];
  previousComponentStartPosition: number;
}

export function CallTemplate(props: SquareProps) {
  const {
    model,
    getDiagramEditorLangClient,
    textDocumentUrl,
    textDocumentFsPath,
    items,
    previousComponentStartPosition,
  } = props;
  const [open, setOpen] = React.useState(false);

  const viewState = model.viewState;
  model.tag;
  const components: JSX.Element[] = [];

  model.children.forEach((child: any) => {
    components.push(getComponent(child.type, { model: child }));
  });

  const [isClicked, setIsClicked] = useState<boolean>(false);

  const handleButtonClick = async () => {
    setOpen(true);
    setIsClicked(true);
  };

  const handleCancelClick = (value: boolean) => {
    setOpen(value);
  };

  return (
    <>
      <svg
        x={viewState.bBox.x}
        y={viewState.bBox.y}
        width={viewState.bBox.r * 2}
        height={viewState.bBox.r * 2}
        viewBox="0 0 600 600"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        onClick={() => handleButtonClick()}
      >
        <circle id="Ellipse 1" cx="300" cy="300" r="300" fill="#3D84B8" />
        <path
          id="Call Template"
          d="M196.196 500.094H189.974C189.861 499.289 189.629 498.574 189.278 497.949C188.928 497.314 188.478 496.775 187.929 496.33C187.38 495.884 186.745 495.544 186.026 495.307C185.315 495.07 184.544 494.952 183.71 494.952C182.205 494.952 180.893 495.326 179.776 496.074C178.658 496.812 177.792 497.892 177.176 499.312C176.561 500.723 176.253 502.437 176.253 504.455C176.253 506.528 176.561 508.271 177.176 509.682C177.801 511.093 178.672 512.158 179.79 512.878C180.907 513.598 182.2 513.957 183.668 513.957C184.491 513.957 185.254 513.848 185.955 513.631C186.665 513.413 187.295 513.096 187.844 512.679C188.393 512.253 188.848 511.737 189.207 511.131C189.577 510.525 189.832 509.833 189.974 509.057L196.196 509.085C196.035 510.42 195.633 511.708 194.989 512.949C194.354 514.18 193.497 515.283 192.418 516.259C191.348 517.224 190.069 517.991 188.582 518.56C187.105 519.118 185.434 519.398 183.568 519.398C180.973 519.398 178.653 518.811 176.608 517.636C174.572 516.462 172.962 514.762 171.778 512.537C170.604 510.312 170.017 507.617 170.017 504.455C170.017 501.282 170.614 498.583 171.807 496.358C173 494.133 174.619 492.437 176.665 491.273C178.71 490.098 181.011 489.511 183.568 489.511C185.254 489.511 186.816 489.748 188.256 490.222C189.705 490.695 190.988 491.386 192.105 492.295C193.223 493.195 194.132 494.298 194.832 495.605C195.543 496.912 195.997 498.408 196.196 500.094ZM206.714 519.412C205.322 519.412 204.082 519.17 202.993 518.688C201.904 518.195 201.042 517.471 200.408 516.514C199.783 515.548 199.47 514.346 199.47 512.906C199.47 511.694 199.693 510.676 200.138 509.852C200.583 509.028 201.189 508.366 201.956 507.864C202.723 507.362 203.594 506.983 204.57 506.727C205.554 506.472 206.587 506.292 207.666 506.188C208.935 506.055 209.958 505.932 210.734 505.818C211.511 505.695 212.074 505.515 212.425 505.278C212.775 505.042 212.95 504.691 212.95 504.227V504.142C212.95 503.242 212.666 502.546 212.098 502.054C211.539 501.562 210.744 501.315 209.712 501.315C208.623 501.315 207.756 501.557 207.112 502.04C206.468 502.513 206.042 503.11 205.834 503.83L200.237 503.375C200.521 502.049 201.08 500.903 201.913 499.938C202.747 498.962 203.821 498.214 205.138 497.693C206.464 497.163 207.998 496.898 209.74 496.898C210.952 496.898 212.112 497.04 213.22 497.324C214.338 497.608 215.327 498.048 216.189 498.645C217.06 499.241 217.747 500.009 218.249 500.946C218.75 501.874 219.001 502.987 219.001 504.284V519H213.263V515.974H213.092C212.742 516.656 212.273 517.258 211.686 517.778C211.099 518.29 210.393 518.692 209.57 518.986C208.746 519.27 207.794 519.412 206.714 519.412ZM208.447 515.236C209.338 515.236 210.124 515.061 210.805 514.71C211.487 514.35 212.022 513.867 212.411 513.261C212.799 512.655 212.993 511.969 212.993 511.202V508.886C212.804 509.009 212.543 509.123 212.212 509.227C211.89 509.322 211.525 509.412 211.118 509.497C210.711 509.573 210.304 509.644 209.896 509.71C209.489 509.767 209.12 509.819 208.788 509.866C208.078 509.971 207.458 510.136 206.928 510.364C206.397 510.591 205.985 510.899 205.692 511.287C205.398 511.666 205.251 512.139 205.251 512.707C205.251 513.531 205.55 514.161 206.146 514.597C206.752 515.023 207.519 515.236 208.447 515.236ZM229.747 489.909V519H223.696V489.909H229.747ZM240.646 489.909V519H234.594V489.909H240.646ZM253.756 494.98V489.909H277.648V494.98H268.742V519H262.663V494.98H253.756ZM288.249 519.426C286.004 519.426 284.072 518.972 282.453 518.062C280.843 517.144 279.603 515.847 278.732 514.17C277.86 512.485 277.425 510.491 277.425 508.19C277.425 505.946 277.86 503.976 278.732 502.281C279.603 500.586 280.829 499.265 282.411 498.318C284.001 497.371 285.867 496.898 288.007 496.898C289.446 496.898 290.786 497.13 292.027 497.594C293.277 498.048 294.366 498.735 295.294 499.653C296.232 500.572 296.961 501.727 297.482 503.119C298.002 504.502 298.263 506.121 298.263 507.977V509.639H279.839V505.889H292.567C292.567 505.018 292.377 504.246 291.999 503.574C291.62 502.902 291.094 502.376 290.422 501.997C289.759 501.609 288.987 501.415 288.107 501.415C287.188 501.415 286.374 501.628 285.663 502.054C284.963 502.471 284.413 503.034 284.016 503.744C283.618 504.445 283.414 505.226 283.405 506.088V509.653C283.405 510.733 283.604 511.666 284.001 512.452C284.409 513.238 284.982 513.844 285.72 514.27C286.459 514.696 287.335 514.909 288.348 514.909C289.02 514.909 289.636 514.814 290.195 514.625C290.753 514.436 291.232 514.152 291.629 513.773C292.027 513.394 292.33 512.93 292.538 512.381L298.135 512.75C297.851 514.095 297.268 515.269 296.388 516.273C295.517 517.267 294.39 518.044 293.007 518.602C291.634 519.152 290.048 519.426 288.249 519.426ZM302.212 519V497.182H307.979V501.031H308.234C308.689 499.753 309.446 498.744 310.507 498.006C311.568 497.267 312.837 496.898 314.314 496.898C315.81 496.898 317.084 497.272 318.135 498.02C319.186 498.759 319.887 499.762 320.237 501.031H320.464C320.91 499.781 321.714 498.782 322.879 498.034C324.054 497.277 325.441 496.898 327.041 496.898C329.077 496.898 330.73 497.546 331.999 498.844C333.277 500.132 333.916 501.959 333.916 504.327V519H327.879V505.52C327.879 504.308 327.557 503.399 326.913 502.793C326.269 502.187 325.464 501.884 324.499 501.884C323.4 501.884 322.543 502.234 321.928 502.935C321.312 503.626 321.004 504.54 321.004 505.676V519H315.138V505.392C315.138 504.322 314.83 503.47 314.214 502.835C313.608 502.201 312.808 501.884 311.814 501.884C311.142 501.884 310.536 502.054 309.996 502.395C309.465 502.726 309.044 503.195 308.732 503.801C308.419 504.398 308.263 505.098 308.263 505.903V519H302.212ZM338.696 527.182V497.182H344.662V500.847H344.932C345.197 500.259 345.58 499.663 346.082 499.057C346.594 498.441 347.257 497.93 348.071 497.523C348.895 497.106 349.918 496.898 351.139 496.898C352.73 496.898 354.198 497.314 355.543 498.148C356.887 498.972 357.962 500.217 358.767 501.884C359.572 503.541 359.974 505.619 359.974 508.119C359.974 510.553 359.581 512.608 358.795 514.284C358.019 515.951 356.958 517.215 355.614 518.077C354.278 518.929 352.782 519.355 351.125 519.355C349.951 519.355 348.952 519.161 348.128 518.773C347.313 518.384 346.646 517.897 346.125 517.31C345.604 516.713 345.206 516.112 344.932 515.506H344.747V527.182H338.696ZM344.619 508.091C344.619 509.388 344.799 510.52 345.159 511.486C345.519 512.452 346.04 513.205 346.722 513.744C347.403 514.275 348.232 514.54 349.207 514.54C350.192 514.54 351.026 514.27 351.707 513.73C352.389 513.181 352.905 512.423 353.256 511.457C353.616 510.482 353.795 509.36 353.795 508.091C353.795 506.831 353.62 505.723 353.27 504.767C352.92 503.811 352.403 503.062 351.722 502.523C351.04 501.983 350.202 501.713 349.207 501.713C348.223 501.713 347.389 501.973 346.707 502.494C346.035 503.015 345.519 503.754 345.159 504.71C344.799 505.667 344.619 506.794 344.619 508.091ZM370.06 489.909V519H364.009V489.909H370.06ZM381.129 519.412C379.737 519.412 378.496 519.17 377.407 518.688C376.318 518.195 375.456 517.471 374.822 516.514C374.197 515.548 373.884 514.346 373.884 512.906C373.884 511.694 374.107 510.676 374.552 509.852C374.997 509.028 375.603 508.366 376.37 507.864C377.137 507.362 378.008 506.983 378.984 506.727C379.969 506.472 381.001 506.292 382.08 506.188C383.349 506.055 384.372 505.932 385.148 505.818C385.925 505.695 386.488 505.515 386.839 505.278C387.189 505.042 387.364 504.691 387.364 504.227V504.142C387.364 503.242 387.08 502.546 386.512 502.054C385.953 501.562 385.158 501.315 384.126 501.315C383.037 501.315 382.17 501.557 381.526 502.04C380.882 502.513 380.456 503.11 380.248 503.83L374.651 503.375C374.935 502.049 375.494 500.903 376.327 499.938C377.161 498.962 378.236 498.214 379.552 497.693C380.878 497.163 382.412 496.898 384.154 496.898C385.366 496.898 386.526 497.04 387.634 497.324C388.752 497.608 389.741 498.048 390.603 498.645C391.474 499.241 392.161 500.009 392.663 500.946C393.165 501.874 393.415 502.987 393.415 504.284V519H387.677V515.974H387.506C387.156 516.656 386.687 517.258 386.1 517.778C385.513 518.29 384.808 518.692 383.984 518.986C383.16 519.27 382.208 519.412 381.129 519.412ZM382.862 515.236C383.752 515.236 384.538 515.061 385.219 514.71C385.901 514.35 386.436 513.867 386.825 513.261C387.213 512.655 387.407 511.969 387.407 511.202V508.886C387.218 509.009 386.957 509.123 386.626 509.227C386.304 509.322 385.939 509.412 385.532 509.497C385.125 509.573 384.718 509.644 384.31 509.71C383.903 509.767 383.534 509.819 383.202 509.866C382.492 509.971 381.872 510.136 381.342 510.364C380.811 510.591 380.399 510.899 380.106 511.287C379.812 511.666 379.665 512.139 379.665 512.707C379.665 513.531 379.964 514.161 380.56 514.597C381.166 515.023 381.933 515.236 382.862 515.236ZM409.715 497.182V501.727H396.576V497.182H409.715ZM399.559 491.955H405.61V512.295C405.61 512.854 405.695 513.29 405.866 513.602C406.036 513.905 406.273 514.118 406.576 514.241C406.888 514.365 407.248 514.426 407.656 514.426C407.94 514.426 408.224 514.402 408.508 514.355C408.792 514.298 409.01 514.256 409.161 514.227L410.113 518.73C409.81 518.825 409.384 518.934 408.835 519.057C408.285 519.189 407.618 519.27 406.832 519.298C405.373 519.355 404.095 519.161 402.996 518.716C401.907 518.271 401.06 517.58 400.454 516.642C399.848 515.705 399.549 514.521 399.559 513.091V491.955ZM423.366 519.426C421.121 519.426 419.19 518.972 417.57 518.062C415.96 517.144 414.72 515.847 413.849 514.17C412.978 512.485 412.542 510.491 412.542 508.19C412.542 505.946 412.978 503.976 413.849 502.281C414.72 500.586 415.946 499.265 417.528 498.318C419.119 497.371 420.984 496.898 423.124 496.898C424.564 496.898 425.904 497.13 427.144 497.594C428.394 498.048 429.483 498.735 430.411 499.653C431.349 500.572 432.078 501.727 432.599 503.119C433.12 504.502 433.38 506.121 433.38 507.977V509.639H414.957V505.889H427.684C427.684 505.018 427.495 504.246 427.116 503.574C426.737 502.902 426.211 502.376 425.539 501.997C424.876 501.609 424.104 501.415 423.224 501.415C422.305 501.415 421.491 501.628 420.781 502.054C420.08 502.471 419.531 503.034 419.133 503.744C418.735 504.445 418.531 505.226 418.522 506.088V509.653C418.522 510.733 418.721 511.666 419.119 512.452C419.526 513.238 420.099 513.844 420.837 514.27C421.576 514.696 422.452 514.909 423.465 514.909C424.138 514.909 424.753 514.814 425.312 514.625C425.871 514.436 426.349 514.152 426.746 513.773C427.144 513.394 427.447 512.93 427.656 512.381L433.252 512.75C432.968 514.095 432.386 515.269 431.505 516.273C430.634 517.267 429.507 518.044 428.124 518.602C426.751 519.152 425.165 519.426 423.366 519.426Z"
          fill="white"
        />
        <rect
          id="Rectangle 1"
          x="144"
          y="195"
          width="150"
          height="200"
          fill="white"
        />
        <rect
          id="Rectangle 2"
          x="309"
          y="195"
          width="150"
          height="200"
          fill="white"
        />
        <rect
          id="Rectangle 3"
          x="144"
          y="153"
          width="315"
          height="18"
          fill="white"
        />
        <rect
          id="Rectangle 4"
          x="144"
          y="419"
          width="315"
          height="18"
          fill="white"
        />
      </svg>

      <WorkerLine model={model} />
      {components}
      {isClicked && (
        <CallTemplateMediatorProperty modalOpen={open} modalClose={handleCancelClick} />
      )}
    </>
  );
}
