/**
 * Copyright (c) 2023, WSO2 LLC. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 *
 */

import React, { useState } from "react";
import { Circle } from "@wso2-ei/low-code-diagram";
import { getComponent } from "../../util";
import { WorkerLine } from "../worker-line";
import { ClassMediatorProperty } from "../PropertyPanels/index";
import {
  DiagramEditorLangClientInterface,
  GetCompletionResponse,
} from "@wso2-ei/low-code-editor-commons";

interface SquareProps {
  model: Circle;
  getDiagramEditorLangClient?: () => Promise<DiagramEditorLangClientInterface>;
  textDocumentUrl: string;
  textDocumentFsPath: string;
  items: GetCompletionResponse[];
  previousComponentStartPosition: number;
}

export function Class(props: SquareProps) {
  const {
    model,
    getDiagramEditorLangClient,
    textDocumentUrl,
    textDocumentFsPath,
    items,
    previousComponentStartPosition,
  } = props;
  const [open, setOpen] = React.useState(false);

  const viewState = model.viewState;
  model.tag;
  const components: JSX.Element[] = [];

  model.children.forEach((child: any) => {
    components.push(getComponent(child.type, { model: child }));
  });

  const [isClicked, setIsClicked] = useState<boolean>(false);

  const handleButtonClick = async () => {
    setOpen(true);
    setIsClicked(true);
  };

  const handleCancelClick = (value: boolean) => {
    setOpen(value);
  };

  return (
    <>
      <svg
        x={viewState.bBox.x}
        y={viewState.bBox.y}
        width={viewState.bBox.r * 2}
        height={viewState.bBox.r * 2}
        viewBox="0 0 600 600"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        onClick={() => handleButtonClick()}
      >
        <circle cx="300" cy="300" r="300" fill="#B97059" />
        <path
          d="M270.245 513.367H262.468C262.326 512.361 262.036 511.467 261.598 510.686C261.16 509.893 260.598 509.218 259.911 508.662C259.225 508.106 258.432 507.679 257.532 507.384C256.644 507.088 255.679 506.94 254.638 506.94C252.756 506.94 251.116 507.407 249.719 508.342C248.323 509.266 247.24 510.615 246.47 512.391C245.701 514.154 245.316 516.297 245.316 518.818C245.316 521.411 245.701 523.589 246.47 525.352C247.251 527.116 248.34 528.448 249.737 529.347C251.134 530.247 252.75 530.697 254.585 530.697C255.614 530.697 256.567 530.561 257.443 530.288C258.331 530.016 259.118 529.62 259.805 529.099C260.491 528.566 261.059 527.921 261.509 527.163C261.971 526.406 262.29 525.542 262.468 524.571L270.245 524.607C270.044 526.276 269.541 527.885 268.736 529.436C267.943 530.975 266.871 532.354 265.522 533.573C264.184 534.781 262.586 535.739 260.728 536.45C258.881 537.148 256.792 537.497 254.46 537.497C251.217 537.497 248.317 536.763 245.76 535.295C243.215 533.828 241.203 531.703 239.723 528.921C238.255 526.139 237.521 522.772 237.521 518.818C237.521 514.853 238.267 511.479 239.759 508.697C241.25 505.916 243.274 503.797 245.831 502.341C248.388 500.873 251.264 500.139 254.46 500.139C256.567 500.139 258.52 500.435 260.32 501.027C262.131 501.619 263.735 502.483 265.131 503.619C266.528 504.744 267.665 506.123 268.54 507.756C269.428 509.39 269.996 511.26 270.245 513.367ZM283.18 500.636V537H275.616V500.636H283.18ZM297.016 537.515C295.276 537.515 293.725 537.213 292.364 536.609C291.003 535.994 289.926 535.088 289.133 533.893C288.351 532.685 287.961 531.182 287.961 529.383C287.961 527.868 288.239 526.595 288.795 525.565C289.352 524.536 290.109 523.707 291.068 523.08C292.027 522.452 293.116 521.979 294.335 521.659C295.566 521.339 296.856 521.115 298.206 520.984C299.792 520.819 301.07 520.665 302.041 520.523C303.012 520.369 303.716 520.144 304.154 519.848C304.592 519.552 304.811 519.114 304.811 518.534V518.428C304.811 517.303 304.456 516.433 303.746 515.817C303.047 515.202 302.053 514.894 300.763 514.894C299.401 514.894 298.318 515.196 297.513 515.8C296.708 516.392 296.176 517.137 295.915 518.037L288.92 517.469C289.275 515.812 289.973 514.379 291.015 513.172C292.056 511.953 293.4 511.018 295.045 510.366C296.702 509.704 298.62 509.372 300.798 509.372C302.313 509.372 303.763 509.55 305.148 509.905C306.545 510.26 307.782 510.81 308.859 511.556C309.948 512.302 310.806 513.261 311.434 514.433C312.061 515.593 312.375 516.983 312.375 518.605V537H305.202V533.218H304.988C304.55 534.07 303.965 534.822 303.231 535.473C302.497 536.112 301.615 536.615 300.585 536.982C299.555 537.337 298.366 537.515 297.016 537.515ZM299.182 532.295C300.295 532.295 301.278 532.076 302.13 531.638C302.982 531.188 303.651 530.584 304.136 529.827C304.622 529.069 304.864 528.211 304.864 527.252V524.358C304.627 524.512 304.302 524.654 303.888 524.784C303.485 524.902 303.029 525.015 302.52 525.121C302.011 525.216 301.502 525.305 300.993 525.388C300.484 525.459 300.023 525.524 299.608 525.583C298.721 525.713 297.945 525.92 297.282 526.205C296.62 526.489 296.105 526.873 295.738 527.359C295.371 527.832 295.187 528.424 295.187 529.134C295.187 530.164 295.56 530.951 296.306 531.496C297.064 532.028 298.022 532.295 299.182 532.295ZM340.935 517.504L334.01 517.93C333.892 517.339 333.637 516.806 333.247 516.332C332.856 515.847 332.341 515.462 331.702 515.178C331.075 514.882 330.323 514.734 329.447 514.734C328.275 514.734 327.287 514.983 326.482 515.48C325.677 515.965 325.274 516.616 325.274 517.433C325.274 518.084 325.535 518.635 326.056 519.085C326.576 519.534 327.47 519.895 328.737 520.168L333.673 521.162C336.324 521.706 338.301 522.582 339.603 523.79C340.905 524.997 341.556 526.583 341.556 528.548C341.556 530.336 341.03 531.904 339.976 533.254C338.934 534.603 337.502 535.656 335.679 536.414C333.868 537.16 331.779 537.533 329.411 537.533C325.801 537.533 322.925 536.781 320.782 535.278C318.651 533.763 317.403 531.703 317.036 529.099L324.475 528.708C324.7 529.809 325.245 530.649 326.109 531.229C326.973 531.798 328.08 532.082 329.429 532.082C330.755 532.082 331.82 531.827 332.625 531.318C333.442 530.797 333.856 530.129 333.868 529.312C333.856 528.625 333.566 528.063 332.998 527.625C332.43 527.175 331.554 526.832 330.37 526.595L325.647 525.654C322.984 525.121 321.001 524.198 319.699 522.884C318.409 521.57 317.764 519.895 317.764 517.859C317.764 516.107 318.237 514.598 319.184 513.332C320.143 512.065 321.486 511.089 323.215 510.402C324.955 509.715 326.991 509.372 329.323 509.372C332.767 509.372 335.478 510.1 337.455 511.556C339.443 513.012 340.603 514.995 340.935 517.504ZM369.011 517.504L362.086 517.93C361.968 517.339 361.713 516.806 361.323 516.332C360.932 515.847 360.417 515.462 359.778 515.178C359.151 514.882 358.399 514.734 357.523 514.734C356.351 514.734 355.363 514.983 354.558 515.48C353.753 515.965 353.35 516.616 353.35 517.433C353.35 518.084 353.611 518.635 354.132 519.085C354.653 519.534 355.546 519.895 356.813 520.168L361.749 521.162C364.4 521.706 366.377 522.582 367.679 523.79C368.981 524.997 369.632 526.583 369.632 528.548C369.632 530.336 369.106 531.904 368.052 533.254C367.011 534.603 365.578 535.656 363.755 536.414C361.944 537.16 359.855 537.533 357.488 537.533C353.877 537.533 351.001 536.781 348.858 535.278C346.728 533.763 345.479 531.703 345.112 529.099L352.551 528.708C352.776 529.809 353.321 530.649 354.185 531.229C355.049 531.798 356.156 532.082 357.505 532.082C358.831 532.082 359.896 531.827 360.701 531.318C361.518 530.797 361.932 530.129 361.944 529.312C361.932 528.625 361.642 528.063 361.074 527.625C360.506 527.175 359.63 526.832 358.446 526.595L353.723 525.654C351.06 525.121 349.077 524.198 347.775 522.884C346.485 521.57 345.84 519.895 345.84 517.859C345.84 516.107 346.313 514.598 347.26 513.332C348.219 512.065 349.563 511.089 351.291 510.402C353.031 509.715 355.067 509.372 357.399 509.372C360.843 509.372 363.554 510.1 365.531 511.556C367.52 513.012 368.68 514.995 369.011 517.504Z"
          fill="white"
        />
        <path d="M314 142L494.999 169H133.001L314 142Z" fill="white" />
        <path d="M314 435L133.001 408L494.999 408L314 435Z" fill="white" />
        <rect x="314" y="109" width="209" height="360" fill="#B97059" />
        <rect
          x="269.5"
          y="170.5"
          width="178"
          height="236"
          rx="8.5"
          fill="#B97059"
          stroke="white"
          stroke-width="3"
        />
        <path
          d="M376.453 231.224C376.453 231.224 320.293 244.31 347.223 273.161C355.188 281.656 345.171 289.309 345.171 289.309C345.171 289.309 365.286 279.743 355.927 267.498C347.223 256.249 340.655 250.662 376.453 231.224ZM339.752 240.407C373.004 215.918 355.927 200 355.927 200C362.823 225.254 331.623 232.907 320.375 248.672C312.657 259.386 324.152 270.942 339.506 284.181C333.676 271.172 313.068 259.998 339.752 240.407ZM317.912 318.39C292.624 324.971 333.348 338.517 365.451 325.736C362.331 324.589 359.293 323.211 356.419 321.604C345.253 323.976 333.758 324.436 322.428 322.981C311.672 321.757 317.912 318.39 317.912 318.39ZM361.592 305.533C347.223 308.441 332.362 309.13 317.748 307.523C306.992 306.528 314.053 301.63 314.053 301.63C286.137 310.278 329.489 319.997 368.242 309.436C365.861 308.594 363.562 307.14 361.592 305.533ZM389.672 330.787C389.672 330.787 394.352 334.384 384.663 337.139C365.943 342.343 307.238 343.95 290.982 337.369C285.152 334.996 296.154 331.706 299.603 331.017C301.491 330.558 303.379 330.405 305.268 330.405C298.782 326.272 263.148 338.823 287.287 342.343C352.724 352.292 406.667 337.751 389.672 330.787ZM367.175 293.594C369.556 292.14 372.101 290.916 374.729 289.845C374.729 289.845 362.331 291.834 349.933 292.906C336.796 294.13 323.577 294.283 310.44 293.365C291.146 290.993 321.032 284.181 321.032 284.181C312 284.181 303.133 286.171 295.087 289.921C278.255 297.574 336.96 301.018 367.175 293.594ZM374.564 312.114C374.4 312.421 374.236 312.65 373.907 312.88C415.042 302.854 399.935 277.37 380.23 283.722C379.162 284.181 378.259 284.794 377.684 285.636C378.834 285.253 379.983 284.947 381.215 284.717C391.067 282.88 405.189 297.191 374.564 312.114ZM375.632 347.394C350.918 351.374 325.63 351.68 300.752 348.465C300.752 348.465 304.529 351.374 323.824 352.521C353.381 354.282 398.785 351.527 399.853 338.517C400.099 338.593 397.964 343.491 375.632 347.394Z"
          fill="white"
        />
        <rect x="133" y="169" width="181" height="239" fill="white" />
        <path
          d="M288.659 261H271.045C270.004 255.934 268.181 251.483 265.577 247.648C263.02 243.812 259.895 240.593 256.202 237.989C252.556 235.337 248.508 233.348 244.057 232.023C239.606 230.697 234.966 230.034 230.136 230.034C221.33 230.034 213.351 232.259 206.202 236.71C199.099 241.161 193.441 247.719 189.227 256.384C185.061 265.048 182.977 275.678 182.977 288.273C182.977 300.867 185.061 311.497 189.227 320.162C193.441 328.827 199.099 335.384 206.202 339.835C213.351 344.286 221.33 346.511 230.136 346.511C234.966 346.511 239.606 345.848 244.057 344.523C248.508 343.197 252.556 341.232 256.202 338.628C259.895 335.976 263.02 332.733 265.577 328.898C268.181 325.015 270.004 320.564 271.045 315.545H288.659C287.333 322.979 284.919 329.632 281.415 335.503C277.911 341.374 273.555 346.369 268.347 350.489C263.138 354.561 257.291 357.662 250.804 359.793C244.365 361.923 237.475 362.989 230.136 362.989C217.731 362.989 206.699 359.958 197.04 353.898C187.381 347.837 179.781 339.22 174.241 328.045C168.702 316.871 165.932 303.614 165.932 288.273C165.932 272.932 168.702 259.674 174.241 248.5C179.781 237.326 187.381 228.708 197.04 222.648C206.699 216.587 217.731 213.557 230.136 213.557C237.475 213.557 244.365 214.622 250.804 216.753C257.291 218.884 263.138 222.009 268.347 226.128C273.555 230.2 277.911 235.171 281.415 241.043C284.919 246.866 287.333 253.519 288.659 261Z"
          fill="#B97059"
        />
      </svg>

      <WorkerLine model={model} />
      {components}
      {isClicked && (
        <ClassMediatorProperty modalOpen={open} modalClose={handleCancelClick} />
      )}
    </>
  );
}
