/**
 * Copyright (c) 2023, WSO2 LLC. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 *
 */

import React, { useState } from "react";
import { Circle } from "@wso2-ei/low-code-diagram";
import { getComponent } from "../../util";
import { WorkerLine } from "../worker-line";
import { StoreMediatorProperty } from "../PropertyPanels/index";
import {
  DiagramEditorLangClientInterface,
  GetCompletionResponse,
} from "@wso2-ei/low-code-editor-commons";

interface SquareProps {
  model: Circle;
  getDiagramEditorLangClient?: () => Promise<DiagramEditorLangClientInterface>;
  textDocumentUrl: string;
  textDocumentFsPath: string;
  items: GetCompletionResponse[];
  previousComponentStartPosition: number;
}

export function Store(props: SquareProps) {
  const {
    model,
    getDiagramEditorLangClient,
    textDocumentUrl,
    textDocumentFsPath,
    items,
    previousComponentStartPosition,
  } = props;
  const [open, setOpen] = React.useState(false);

  const viewState = model.viewState;
  model.tag;
  const components: JSX.Element[] = [];

  model.children.forEach((child: any) => {
    components.push(getComponent(child.type, { model: child }));
  });

  const [isClicked, setIsClicked] = useState<boolean>(false);

  const handleButtonClick = async () => {
    setOpen(true);
    setIsClicked(true);
  };

  const handleCancelClick = (value: boolean) => {
    setOpen(value);
  };

  return (
    <>
      <svg
        x={viewState.bBox.x}
        y={viewState.bBox.y}
        width={viewState.bBox.r * 2}
        height={viewState.bBox.r * 2}
        viewBox="0 0 600 600"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        onClick={() => handleButtonClick()}
      >
        <circle id="Ellipse 1" cx="300" cy="300" r="300" fill="#3D84B8" />
        <path
          id="Store"
          d="M267.31 502.276C267.196 501.13 266.708 500.24 265.847 499.605C264.985 498.971 263.815 498.653 262.338 498.653C261.334 498.653 260.487 498.795 259.795 499.08C259.104 499.354 258.574 499.738 258.205 500.23C257.845 500.723 257.665 501.281 257.665 501.906C257.646 502.427 257.755 502.882 257.991 503.27C258.238 503.658 258.574 503.994 259 504.278C259.426 504.553 259.919 504.795 260.477 505.003C261.036 505.202 261.633 505.372 262.267 505.514L264.881 506.139C266.15 506.423 267.314 506.802 268.375 507.276C269.436 507.749 270.354 508.331 271.131 509.023C271.907 509.714 272.509 510.528 272.935 511.466C273.37 512.403 273.593 513.478 273.602 514.69C273.593 516.471 273.138 518.014 272.239 519.321C271.348 520.618 270.061 521.627 268.375 522.347C266.699 523.057 264.677 523.412 262.31 523.412C259.961 523.412 257.916 523.052 256.173 522.332C254.44 521.613 253.086 520.547 252.111 519.136C251.145 517.716 250.638 515.959 250.591 513.866H256.543C256.609 514.842 256.888 515.656 257.381 516.31C257.883 516.954 258.55 517.441 259.384 517.773C260.226 518.095 261.178 518.256 262.239 518.256C263.28 518.256 264.185 518.104 264.952 517.801C265.728 517.498 266.33 517.077 266.756 516.537C267.182 515.997 267.395 515.377 267.395 514.676C267.395 514.023 267.201 513.473 266.812 513.028C266.434 512.583 265.875 512.205 265.136 511.892C264.407 511.58 263.512 511.295 262.452 511.04L259.284 510.244C256.831 509.648 254.895 508.715 253.474 507.446C252.054 506.177 251.348 504.468 251.358 502.318C251.348 500.557 251.817 499.018 252.764 497.702C253.721 496.385 255.032 495.358 256.699 494.619C258.366 493.881 260.259 493.511 262.381 493.511C264.54 493.511 266.424 493.881 268.034 494.619C269.653 495.358 270.913 496.385 271.812 497.702C272.712 499.018 273.176 500.543 273.205 502.276H267.31ZM289.231 501.182V505.727H276.092V501.182H289.231ZM279.075 495.955H285.126V516.295C285.126 516.854 285.211 517.29 285.381 517.602C285.552 517.905 285.789 518.118 286.092 518.241C286.404 518.365 286.764 518.426 287.171 518.426C287.455 518.426 287.739 518.402 288.023 518.355C288.308 518.298 288.525 518.256 288.677 518.227L289.629 522.73C289.326 522.825 288.899 522.934 288.35 523.057C287.801 523.189 287.133 523.27 286.347 523.298C284.889 523.355 283.611 523.161 282.512 522.716C281.423 522.271 280.576 521.58 279.969 520.642C279.363 519.705 279.065 518.521 279.075 517.091V495.955ZM302.796 523.426C300.59 523.426 298.682 522.957 297.072 522.02C295.471 521.073 294.236 519.757 293.364 518.071C292.493 516.376 292.058 514.411 292.058 512.176C292.058 509.922 292.493 507.953 293.364 506.267C294.236 504.572 295.471 503.256 297.072 502.318C298.682 501.371 300.59 500.898 302.796 500.898C305.003 500.898 306.906 501.371 308.506 502.318C310.116 503.256 311.357 504.572 312.228 506.267C313.099 507.953 313.535 509.922 313.535 512.176C313.535 514.411 313.099 516.376 312.228 518.071C311.357 519.757 310.116 521.073 308.506 522.02C306.906 522.957 305.003 523.426 302.796 523.426ZM302.825 518.739C303.828 518.739 304.666 518.455 305.339 517.886C306.011 517.309 306.518 516.523 306.859 515.528C307.209 514.534 307.384 513.402 307.384 512.134C307.384 510.865 307.209 509.733 306.859 508.739C306.518 507.744 306.011 506.958 305.339 506.381C304.666 505.803 303.828 505.514 302.825 505.514C301.811 505.514 300.959 505.803 300.268 506.381C299.586 506.958 299.07 507.744 298.719 508.739C298.379 509.733 298.208 510.865 298.208 512.134C298.208 513.402 298.379 514.534 298.719 515.528C299.07 516.523 299.586 517.309 300.268 517.886C300.959 518.455 301.811 518.739 302.825 518.739ZM317.469 523V501.182H323.336V504.989H323.563C323.961 503.634 324.629 502.612 325.566 501.92C326.504 501.22 327.583 500.869 328.805 500.869C329.108 500.869 329.434 500.888 329.785 500.926C330.135 500.964 330.443 501.016 330.708 501.082V506.452C330.424 506.366 330.031 506.291 329.529 506.224C329.027 506.158 328.568 506.125 328.151 506.125C327.261 506.125 326.466 506.319 325.765 506.707C325.074 507.086 324.524 507.616 324.117 508.298C323.719 508.98 323.521 509.766 323.521 510.656V523H317.469ZM342.764 523.426C340.52 523.426 338.588 522.972 336.969 522.062C335.359 521.144 334.118 519.847 333.247 518.17C332.376 516.485 331.94 514.491 331.94 512.19C331.94 509.946 332.376 507.976 333.247 506.281C334.118 504.586 335.345 503.265 336.926 502.318C338.517 501.371 340.383 500.898 342.523 500.898C343.962 500.898 345.302 501.13 346.543 501.594C347.793 502.048 348.882 502.735 349.81 503.653C350.747 504.572 351.476 505.727 351.997 507.119C352.518 508.502 352.778 510.121 352.778 511.977V513.639H334.355V509.889H347.082C347.082 509.018 346.893 508.246 346.514 507.574C346.135 506.902 345.61 506.376 344.938 505.997C344.275 505.609 343.503 505.415 342.622 505.415C341.704 505.415 340.889 505.628 340.179 506.054C339.478 506.471 338.929 507.034 338.531 507.744C338.134 508.445 337.93 509.226 337.92 510.088V513.653C337.92 514.733 338.119 515.666 338.517 516.452C338.924 517.238 339.497 517.844 340.236 518.27C340.974 518.696 341.85 518.909 342.864 518.909C343.536 518.909 344.152 518.814 344.71 518.625C345.269 518.436 345.747 518.152 346.145 517.773C346.543 517.394 346.846 516.93 347.054 516.381L352.651 516.75C352.366 518.095 351.784 519.269 350.903 520.273C350.032 521.267 348.905 522.044 347.523 522.602C346.15 523.152 344.563 523.426 342.764 523.426Z"
          fill="white"
        />
        <path
          id="Vector"
          d="M369.833 300.222C344.396 300.222 322.124 313.82 309.816 334.099C302.782 334.92 295.397 335.389 287.778 335.389C235.966 335.389 194 314.406 194 288.5V253.333C194 279.239 235.966 300.222 287.778 300.222C339.59 300.222 381.556 279.239 381.556 253.333V288.5C381.556 292.72 380.383 296.823 378.273 300.808C375.694 300.222 372.647 300.222 369.833 300.222ZM287.778 276.778C339.59 276.778 381.556 255.795 381.556 229.889C381.556 203.983 339.59 183 287.778 183C235.966 183 194 203.983 194 229.889C194 255.795 235.966 276.778 287.778 276.778ZM300.672 358.364C296.452 358.833 292.115 358.833 287.778 358.833C235.966 358.833 194 337.851 194 311.944V347.111C194 373.017 235.966 394 287.778 394C293.17 394 298.328 394 303.368 393.297C300.907 386.146 299.5 378.527 299.5 370.556C299.5 366.336 299.969 362.35 300.672 358.364ZM381.556 382.278V335.389H358.111V382.278H334.667L369.833 417.444L405 382.278H381.556Z"
          fill="white"
        />
      </svg>

      <WorkerLine model={model} />
      {components}
      {isClicked && (
        <StoreMediatorProperty modalOpen={open} modalClose={handleCancelClick} />
      )}
    </>
  );
}
