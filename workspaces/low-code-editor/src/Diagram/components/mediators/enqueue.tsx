/**
 * Copyright (c) 2023, WSO2 LLC. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 *
 */

import React, { useState } from "react";
import { Circle } from "@wso2-ei/low-code-diagram";
import { getComponent } from "../../util";
import { WorkerLine } from "../worker-line";
import { EnqueueMediatorProperty } from "../PropertyPanels/index";
import {
  DiagramEditorLangClientInterface,
  GetCompletionResponse,
} from "@wso2-ei/low-code-editor-commons";

interface SquareProps {
  model: Circle;
  getDiagramEditorLangClient?: () => Promise<DiagramEditorLangClientInterface>;
  textDocumentUrl: string;
  textDocumentFsPath: string;
  items: GetCompletionResponse[];
  previousComponentStartPosition: number;
}

export function Enqueue(props: SquareProps) {
  const {
    model,
    getDiagramEditorLangClient,
    textDocumentUrl,
    textDocumentFsPath,
    items,
    previousComponentStartPosition,
  } = props;
  const [open, setOpen] = React.useState(false);

  const viewState = model.viewState;
  model.tag;
  const components: JSX.Element[] = [];

  model.children.forEach((child: any) => {
    components.push(getComponent(child.type, { model: child }));
  });

  const [isClicked, setIsClicked] = useState<boolean>(false);

  const handleButtonClick = async () => {
    setOpen(true);
    setIsClicked(true);
  };

  const handleCancelClick = (value: boolean) => {
    setOpen(value);
  };

  return (
    <>
      <svg
        x={viewState.bBox.x}
        y={viewState.bBox.y}
        width={viewState.bBox.r * 2}
        height={viewState.bBox.r * 2}
        viewBox="0 0 600 600"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        onClick={() => handleButtonClick()}
      >
        <circle cx="300" cy="300" r="300" fill="#008234" />
        <path
          d="M211.528 523V493.909H231.131V498.98H217.679V505.912H230.122V510.983H217.679V517.929H231.188V523H211.528ZM241.958 510.386V523H235.907V501.182H241.674V505.031H241.93C242.413 503.762 243.222 502.759 244.359 502.02C245.495 501.272 246.873 500.898 248.492 500.898C250.007 500.898 251.328 501.229 252.455 501.892C253.582 502.555 254.458 503.502 255.083 504.733C255.708 505.955 256.021 507.413 256.021 509.108V523H249.969V510.188C249.979 508.852 249.638 507.811 248.947 507.062C248.255 506.305 247.304 505.926 246.092 505.926C245.277 505.926 244.558 506.101 243.933 506.452C243.317 506.802 242.834 507.313 242.484 507.986C242.143 508.649 241.968 509.449 241.958 510.386ZM275.207 531.182V519.506H275.023C274.739 520.112 274.336 520.713 273.815 521.31C273.304 521.897 272.636 522.384 271.812 522.773C270.998 523.161 270.004 523.355 268.83 523.355C267.172 523.355 265.671 522.929 264.327 522.077C262.991 521.215 261.931 519.951 261.145 518.284C260.368 516.608 259.98 514.553 259.98 512.119C259.98 509.619 260.383 507.541 261.188 505.884C261.992 504.217 263.063 502.972 264.398 502.148C265.742 501.314 267.215 500.898 268.815 500.898C270.037 500.898 271.055 501.106 271.869 501.523C272.693 501.93 273.356 502.441 273.858 503.057C274.369 503.663 274.758 504.259 275.023 504.847H275.278V501.182H281.244V531.182H275.207ZM270.747 518.54C271.723 518.54 272.546 518.275 273.219 517.744C273.901 517.205 274.421 516.452 274.781 515.486C275.151 514.52 275.335 513.388 275.335 512.091C275.335 510.794 275.155 509.667 274.795 508.71C274.436 507.754 273.915 507.015 273.233 506.494C272.551 505.973 271.723 505.713 270.747 505.713C269.753 505.713 268.915 505.983 268.233 506.523C267.551 507.062 267.035 507.811 266.685 508.767C266.334 509.723 266.159 510.831 266.159 512.091C266.159 513.36 266.334 514.482 266.685 515.457C267.045 516.423 267.561 517.181 268.233 517.73C268.915 518.27 269.753 518.54 270.747 518.54ZM300.094 513.71V501.182H306.145V523H300.335V519.037H300.108C299.616 520.315 298.796 521.343 297.651 522.119C296.514 522.896 295.127 523.284 293.489 523.284C292.03 523.284 290.747 522.953 289.639 522.29C288.531 521.627 287.665 520.685 287.04 519.463C286.424 518.241 286.112 516.778 286.102 515.074V501.182H292.153V513.994C292.163 515.282 292.509 516.3 293.19 517.048C293.872 517.796 294.786 518.17 295.932 518.17C296.661 518.17 297.343 518.005 297.977 517.673C298.612 517.332 299.123 516.83 299.511 516.168C299.909 515.505 300.103 514.686 300.094 513.71ZM320.928 523.426C318.684 523.426 316.752 522.972 315.133 522.062C313.523 521.144 312.282 519.847 311.411 518.17C310.54 516.485 310.104 514.491 310.104 512.19C310.104 509.946 310.54 507.976 311.411 506.281C312.282 504.586 313.509 503.265 315.09 502.318C316.681 501.371 318.547 500.898 320.687 500.898C322.126 500.898 323.466 501.13 324.707 501.594C325.957 502.048 327.046 502.735 327.974 503.653C328.911 504.572 329.64 505.727 330.161 507.119C330.682 508.502 330.942 510.121 330.942 511.977V513.639H312.519V509.889H325.246C325.246 509.018 325.057 508.246 324.678 507.574C324.299 506.902 323.774 506.376 323.102 505.997C322.439 505.609 321.667 505.415 320.786 505.415C319.868 505.415 319.053 505.628 318.343 506.054C317.642 506.471 317.093 507.034 316.695 507.744C316.298 508.445 316.094 509.226 316.085 510.088V513.653C316.085 514.733 316.283 515.666 316.681 516.452C317.088 517.238 317.661 517.844 318.4 518.27C319.138 518.696 320.014 518.909 321.028 518.909C321.7 518.909 322.316 518.814 322.874 518.625C323.433 518.436 323.911 518.152 324.309 517.773C324.707 517.394 325.01 516.93 325.218 516.381L330.815 516.75C330.531 518.095 329.948 519.269 329.067 520.273C328.196 521.267 327.069 522.044 325.687 522.602C324.314 523.152 322.728 523.426 320.928 523.426ZM348.883 513.71V501.182H354.934V523H349.124V519.037H348.897C348.405 520.315 347.585 521.343 346.44 522.119C345.303 522.896 343.916 523.284 342.278 523.284C340.819 523.284 339.536 522.953 338.428 522.29C337.32 521.627 336.454 520.685 335.829 519.463C335.213 518.241 334.901 516.778 334.891 515.074V501.182H340.942V513.994C340.952 515.282 341.298 516.3 341.979 517.048C342.661 517.796 343.575 518.17 344.721 518.17C345.45 518.17 346.132 518.005 346.766 517.673C347.401 517.332 347.912 516.83 348.3 516.168C348.698 515.505 348.892 514.686 348.883 513.71ZM369.717 523.426C367.473 523.426 365.541 522.972 363.922 522.062C362.312 521.144 361.071 519.847 360.2 518.17C359.329 516.485 358.893 514.491 358.893 512.19C358.893 509.946 359.329 507.976 360.2 506.281C361.071 504.586 362.298 503.265 363.879 502.318C365.47 501.371 367.336 500.898 369.476 500.898C370.915 500.898 372.255 501.13 373.496 501.594C374.746 502.048 375.835 502.735 376.763 503.653C377.7 504.572 378.429 505.727 378.95 507.119C379.471 508.502 379.732 510.121 379.732 511.977V513.639H361.308V509.889H374.036C374.036 509.018 373.846 508.246 373.467 507.574C373.089 506.902 372.563 506.376 371.891 505.997C371.228 505.609 370.456 505.415 369.575 505.415C368.657 505.415 367.842 505.628 367.132 506.054C366.431 506.471 365.882 507.034 365.484 507.744C365.087 508.445 364.883 509.226 364.874 510.088V513.653C364.874 514.733 365.072 515.666 365.47 516.452C365.877 517.238 366.45 517.844 367.189 518.27C367.928 518.696 368.804 518.909 369.817 518.909C370.489 518.909 371.105 518.814 371.663 518.625C372.222 518.436 372.7 518.152 373.098 517.773C373.496 517.394 373.799 516.93 374.007 516.381L379.604 516.75C379.32 518.095 378.737 519.269 377.857 520.273C376.985 521.267 375.858 522.044 374.476 522.602C373.103 523.152 371.517 523.426 369.717 523.426Z"
          fill="white"
        />
        <rect
          x="128.5"
          y="303.5"
          width="344"
          height="105"
          rx="8.5"
          fill="#008234"
          stroke="white"
          stroke-width="3"
        />
        <path
          d="M332 164L300 184L268 164V156L300 176L332 156M332 148H268C263.56 148 260 151.56 260 156V204C260 206.122 260.843 208.157 262.343 209.657C263.843 211.157 265.878 212 268 212H332C334.122 212 336.157 211.157 337.657 209.657C339.157 208.157 340 206.122 340 204V156C340 151.56 336.4 148 332 148Z"
          fill="white"
        />
        <path
          d="M332 340L300 360L268 340V332L300 352L332 332M332 324H268C263.56 324 260 327.56 260 332V380C260 382.122 260.843 384.157 262.343 385.657C263.843 387.157 265.878 388 268 388H332C334.122 388 336.157 387.157 337.657 385.657C339.157 384.157 340 382.122 340 380V332C340 327.56 336.4 324 332 324Z"
          fill="white"
        />
        <path
          d="M226 340L194 360L162 340V332L194 352L226 332M226 324H162C157.56 324 154 327.56 154 332V380C154 382.122 154.843 384.157 156.343 385.657C157.843 387.157 159.878 388 162 388H226C228.122 388 230.157 387.157 231.657 385.657C233.157 384.157 234 382.122 234 380V332C234 327.56 230.4 324 226 324Z"
          fill="white"
        />
        <path
          d="M438 340L406 360L374 340V332L406 352L438 332M438 324H374C369.56 324 366 327.56 366 332V380C366 382.122 366.843 384.157 368.343 385.657C369.843 387.157 371.878 388 374 388H438C440.122 388 442.157 387.157 443.657 385.657C445.157 384.157 446 382.122 446 380V332C446 327.56 442.4 324 438 324Z"
          fill="white"
        />
        <path
          d="M296.212 218H303.788V277.848L324.621 250.418L330 257.5L300 297L270 257.5L275.379 250.418L296.212 277.848V218Z"
          fill="white"
        />
      </svg>

      <WorkerLine model={model} />
      {components}
      {isClicked && (
        <EnqueueMediatorProperty modalOpen={open} modalClose={handleCancelClick} />
      )}
    </>
  );
}
