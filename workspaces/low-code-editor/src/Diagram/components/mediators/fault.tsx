/**
 * Copyright (c) 2023, WSO2 LLC. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 *
 */

import React, { useState } from "react";
import { Circle } from "@wso2-ei/low-code-diagram";
import { getComponent } from "../../util";
import { WorkerLine } from "../worker-line";
import { FaultMediatorProperty } from "../PropertyPanels/index";
import {
  DiagramEditorLangClientInterface,
  GetCompletionResponse,
} from "@wso2-ei/low-code-editor-commons";

interface SquareProps {
  model: Circle;
  getDiagramEditorLangClient?: () => Promise<DiagramEditorLangClientInterface>;
  textDocumentUrl: string;
  textDocumentFsPath: string;
  items: GetCompletionResponse[];
  previousComponentStartPosition: number;
}

export function Fault(props: SquareProps) {
  const {
    model,
    getDiagramEditorLangClient,
    textDocumentUrl,
    textDocumentFsPath,
    items,
    previousComponentStartPosition,
  } = props;
  const [open, setOpen] = React.useState(false);

  const viewState = model.viewState;
  model.tag;
  const components: JSX.Element[] = [];

  model.children.forEach((child: any) => {
    components.push(getComponent(child.type, { model: child }));
  });

  const [isClicked, setIsClicked] = useState<boolean>(false);

  const handleButtonClick = async () => {
    setOpen(true);
    setIsClicked(true);
  };

  const handleCancelClick = (value: boolean) => {
    setOpen(value);
  };

  return (
    <>
      <svg
        x={viewState.bBox.x}
        y={viewState.bBox.y}
        width={viewState.bBox.r * 2}
        height={viewState.bBox.r * 2}
        viewBox="0 0 600 600"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        onClick={() => handleButtonClick()}
      >
        <circle cx="300" cy="300" r="300" fill="#644A9B" />
        <path
          d="M298.81 365.947C298.81 361.778 299.354 357.731 300.035 353.684H176.238V231.053L285.19 292.368L394.143 231.053V293.472C403.949 294.944 413.073 298.009 421.381 302.302V206.526C421.381 193.037 409.124 182 394.143 182H176.238C161.257 182 149 193.037 149 206.526V353.684C149 367.174 161.257 378.211 176.238 378.211H300.035C299.354 374.164 298.81 370.117 298.81 365.947ZM394.143 206.526L285.19 267.842L176.238 206.526H394.143ZM394.143 316.895V353.684H435V378.211H394.143V415H366.905V378.211H326.048V353.684H366.905V316.895H394.143Z"
          fill="white"
        />
        <ellipse cx="378" cy="352.5" rx="72" ry="64.5" fill="#644A9B" />
        <path
          d="M360.9 328L372.3 353L360.9 378H372.3L378 365.5L383.7 378H395.1L383.7 353L395.1 328H383.7L378 340.5L372.3 328H360.9ZM378 303C385.485 303 392.897 304.293 399.813 306.806C406.729 309.319 413.012 313.002 418.305 317.645C423.598 322.288 427.797 327.8 430.661 333.866C433.526 339.932 435 346.434 435 353C435 366.261 428.995 378.979 418.305 388.355C407.616 397.732 393.117 403 378 403C370.515 403 363.103 401.707 356.187 399.194C349.271 396.681 342.988 392.998 337.695 388.355C327.005 378.979 321 366.261 321 353C321 339.739 327.005 327.021 337.695 317.645C348.384 308.268 362.883 303 378 303Z"
          fill="white"
        />
        <path
          d="M247.161 527V490.636H271.237V496.975H254.849V505.64H269.639V511.979H254.849V527H247.161ZM283.702 527.515C281.962 527.515 280.411 527.213 279.05 526.609C277.688 525.994 276.611 525.088 275.818 523.893C275.037 522.685 274.646 521.182 274.646 519.383C274.646 517.868 274.924 516.595 275.481 515.565C276.037 514.536 276.795 513.707 277.754 513.08C278.712 512.452 279.801 511.979 281.021 511.659C282.252 511.339 283.542 511.115 284.891 510.984C286.478 510.819 287.756 510.665 288.727 510.523C289.697 510.369 290.402 510.144 290.839 509.848C291.277 509.552 291.496 509.114 291.496 508.534V508.428C291.496 507.303 291.141 506.433 290.431 505.817C289.733 505.202 288.738 504.894 287.448 504.894C286.087 504.894 285.004 505.196 284.199 505.8C283.394 506.392 282.861 507.137 282.601 508.037L275.605 507.469C275.96 505.812 276.659 504.379 277.7 503.172C278.742 501.953 280.085 501.018 281.731 500.366C283.388 499.704 285.306 499.372 287.484 499.372C288.999 499.372 290.449 499.55 291.834 499.905C293.231 500.26 294.468 500.81 295.545 501.556C296.634 502.302 297.492 503.261 298.119 504.433C298.747 505.593 299.06 506.983 299.06 508.605V527H291.887V523.218H291.674C291.236 524.07 290.65 524.822 289.916 525.473C289.182 526.112 288.3 526.615 287.271 526.982C286.241 527.337 285.051 527.515 283.702 527.515ZM285.868 522.295C286.981 522.295 287.963 522.076 288.815 521.638C289.668 521.188 290.336 520.584 290.822 519.827C291.307 519.069 291.55 518.211 291.55 517.252V514.358C291.313 514.512 290.987 514.654 290.573 514.784C290.171 514.902 289.715 515.015 289.206 515.121C288.697 515.216 288.188 515.305 287.679 515.388C287.17 515.459 286.708 515.524 286.294 515.583C285.406 515.713 284.631 515.92 283.968 516.205C283.305 516.489 282.79 516.873 282.423 517.359C282.056 517.832 281.873 518.424 281.873 519.134C281.873 520.164 282.246 520.951 282.991 521.496C283.749 522.028 284.708 522.295 285.868 522.295ZM322.418 515.388V499.727H329.982V527H322.72V522.046H322.436C321.82 523.644 320.796 524.929 319.364 525.899C317.944 526.87 316.209 527.355 314.162 527.355C312.339 527.355 310.735 526.941 309.35 526.112C307.965 525.284 306.882 524.106 306.1 522.579C305.331 521.052 304.94 519.223 304.929 517.092V499.727H312.493V515.743C312.504 517.353 312.936 518.625 313.789 519.56C314.641 520.496 315.783 520.963 317.216 520.963C318.127 520.963 318.979 520.756 319.772 520.342C320.565 519.915 321.205 519.288 321.69 518.46C322.187 517.631 322.43 516.607 322.418 515.388ZM343.596 490.636V527H336.032V490.636H343.596ZM364.162 499.727V505.409H347.738V499.727H364.162ZM351.466 493.193H359.03V518.619C359.03 519.318 359.137 519.862 359.35 520.253C359.563 520.632 359.859 520.898 360.238 521.052C360.628 521.206 361.078 521.283 361.587 521.283C361.942 521.283 362.297 521.253 362.652 521.194C363.007 521.123 363.28 521.07 363.469 521.034L364.659 526.663C364.28 526.781 363.747 526.917 363.061 527.071C362.374 527.237 361.54 527.337 360.557 527.373C358.734 527.444 357.136 527.201 355.763 526.645C354.402 526.089 353.342 525.224 352.585 524.053C351.827 522.881 351.454 521.401 351.466 519.614V493.193Z"
          fill="white"
        />
      </svg>

      <WorkerLine model={model} />
      {components}
      {isClicked && (
        <FaultMediatorProperty modalOpen={open} modalClose={handleCancelClick} />
      )}
    </>
  );
}
