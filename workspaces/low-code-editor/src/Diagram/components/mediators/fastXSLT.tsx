/**
 * Copyright (c) 2023, WSO2 LLC. (http://www.wso2.org) All Rights Reserved.
 *
 * WSO2 Inc. licenses this file to you under the Apache License,
 * Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations
 * under the License.
 *
 */

import React, { useState } from "react";
import { Circle } from "@wso2-ei/low-code-diagram";
import { getComponent } from "../../util";
import { WorkerLine } from "../worker-line";
import { FastXSLTMediatorProperty } from "../PropertyPanels/index";
import {
  DiagramEditorLangClientInterface,
  GetCompletionResponse,
} from "@wso2-ei/low-code-editor-commons";

interface SquareProps {
  model: Circle;
  getDiagramEditorLangClient?: () => Promise<DiagramEditorLangClientInterface>;
  textDocumentUrl: string;
  textDocumentFsPath: string;
  items: GetCompletionResponse[];
  previousComponentStartPosition: number;
}

export function FastXSLT(props: SquareProps) {
  const {
    model,
    getDiagramEditorLangClient,
    textDocumentUrl,
    textDocumentFsPath,
    items,
    previousComponentStartPosition,
  } = props;
  const [open, setOpen] = React.useState(false);

  const viewState = model.viewState;
  model.tag;
  const components: JSX.Element[] = [];

  model.children.forEach((child: any) => {
    components.push(getComponent(child.type, { model: child }));
  });

  const [isClicked, setIsClicked] = useState<boolean>(false);

  const handleButtonClick = async () => {
    setOpen(true);
    setIsClicked(true);
  };

  const handleCancelClick = (value: boolean) => {
    setOpen(value);
  };

  return (
    <>
      <svg
        x={viewState.bBox.x}
        y={viewState.bBox.y}
        width={viewState.bBox.r * 2}
        height={viewState.bBox.r * 2}
        viewBox="0 0 600 600"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
        onClick={() => handleButtonClick()}
      >
        <circle cx="300" cy="300" r="300" fill="#644A9B" />
        <path
          d="M212.528 493V463.909H231.79V468.98H218.679V475.912H230.511V480.983H218.679V493H212.528ZM241.761 493.412C240.369 493.412 239.129 493.17 238.04 492.688C236.951 492.195 236.089 491.471 235.455 490.514C234.83 489.548 234.517 488.346 234.517 486.906C234.517 485.694 234.74 484.676 235.185 483.852C235.63 483.028 236.236 482.366 237.003 481.864C237.77 481.362 238.641 480.983 239.616 480.727C240.601 480.472 241.634 480.292 242.713 480.188C243.982 480.055 245.005 479.932 245.781 479.818C246.558 479.695 247.121 479.515 247.472 479.278C247.822 479.042 247.997 478.691 247.997 478.227V478.142C247.997 477.242 247.713 476.546 247.145 476.054C246.586 475.562 245.791 475.315 244.759 475.315C243.67 475.315 242.803 475.557 242.159 476.04C241.515 476.513 241.089 477.11 240.881 477.83L235.284 477.375C235.568 476.049 236.127 474.903 236.96 473.938C237.794 472.962 238.868 472.214 240.185 471.693C241.51 471.163 243.045 470.898 244.787 470.898C245.999 470.898 247.159 471.04 248.267 471.324C249.384 471.608 250.374 472.048 251.236 472.645C252.107 473.241 252.794 474.009 253.295 474.946C253.797 475.874 254.048 476.987 254.048 478.284V493H248.31V489.974H248.139C247.789 490.656 247.32 491.258 246.733 491.778C246.146 492.29 245.44 492.692 244.616 492.986C243.793 493.27 242.841 493.412 241.761 493.412ZM243.494 489.236C244.384 489.236 245.17 489.061 245.852 488.71C246.534 488.35 247.069 487.867 247.457 487.261C247.846 486.655 248.04 485.969 248.04 485.202V482.886C247.85 483.009 247.59 483.123 247.259 483.227C246.937 483.322 246.572 483.412 246.165 483.497C245.758 483.573 245.35 483.644 244.943 483.71C244.536 483.767 244.167 483.819 243.835 483.866C243.125 483.971 242.505 484.136 241.974 484.364C241.444 484.591 241.032 484.899 240.739 485.287C240.445 485.666 240.298 486.139 240.298 486.707C240.298 487.531 240.597 488.161 241.193 488.597C241.799 489.023 242.566 489.236 243.494 489.236ZM276.896 477.403L271.357 477.744C271.262 477.271 271.058 476.845 270.746 476.466C270.433 476.078 270.021 475.77 269.51 475.543C269.008 475.306 268.407 475.188 267.706 475.188C266.768 475.188 265.978 475.386 265.334 475.784C264.69 476.172 264.368 476.693 264.368 477.347C264.368 477.867 264.576 478.308 264.993 478.668C265.41 479.027 266.125 479.316 267.138 479.534L271.087 480.33C273.208 480.765 274.789 481.466 275.831 482.432C276.873 483.398 277.393 484.667 277.393 486.239C277.393 487.669 276.972 488.923 276.129 490.003C275.296 491.082 274.15 491.925 272.692 492.531C271.243 493.128 269.571 493.426 267.678 493.426C264.789 493.426 262.488 492.825 260.774 491.622C259.07 490.41 258.071 488.762 257.777 486.679L263.729 486.366C263.909 487.247 264.344 487.92 265.036 488.384C265.727 488.838 266.612 489.065 267.692 489.065C268.752 489.065 269.605 488.862 270.249 488.455C270.902 488.038 271.233 487.503 271.243 486.849C271.233 486.3 271.001 485.85 270.547 485.5C270.092 485.14 269.392 484.866 268.445 484.676L264.666 483.923C262.536 483.497 260.949 482.759 259.908 481.707C258.875 480.656 258.359 479.316 258.359 477.688C258.359 476.286 258.738 475.079 259.496 474.065C260.263 473.052 261.338 472.271 262.72 471.722C264.112 471.172 265.741 470.898 267.607 470.898C270.362 470.898 272.531 471.48 274.112 472.645C275.703 473.81 276.631 475.396 276.896 477.403ZM292.809 471.182V475.727H279.67V471.182H292.809ZM282.653 465.955H288.704V486.295C288.704 486.854 288.789 487.29 288.96 487.602C289.13 487.905 289.367 488.118 289.67 488.241C289.982 488.365 290.342 488.426 290.749 488.426C291.033 488.426 291.317 488.402 291.602 488.355C291.886 488.298 292.103 488.256 292.255 488.227L293.207 492.73C292.904 492.825 292.478 492.934 291.928 493.057C291.379 493.189 290.711 493.27 289.925 493.298C288.467 493.355 287.189 493.161 286.09 492.716C285.001 492.271 284.154 491.58 283.548 490.642C282.942 489.705 282.643 488.521 282.653 487.091V465.955ZM311.889 463.909L317.756 473.824H317.983L323.878 463.909H330.824L321.946 478.455L331.023 493H323.949L317.983 483.071H317.756L311.79 493H304.744L313.849 478.455L304.915 463.909H311.889ZM350.497 472.276C350.384 471.13 349.896 470.24 349.034 469.605C348.172 468.971 347.003 468.653 345.526 468.653C344.522 468.653 343.674 468.795 342.983 469.08C342.292 469.354 341.761 469.738 341.392 470.23C341.032 470.723 340.852 471.281 340.852 471.906C340.833 472.427 340.942 472.882 341.179 473.27C341.425 473.658 341.761 473.994 342.188 474.278C342.614 474.553 343.106 474.795 343.665 475.003C344.223 475.202 344.82 475.372 345.455 475.514L348.068 476.139C349.337 476.423 350.502 476.802 351.562 477.276C352.623 477.749 353.542 478.331 354.318 479.023C355.095 479.714 355.696 480.528 356.122 481.466C356.558 482.403 356.78 483.478 356.79 484.69C356.78 486.471 356.326 488.014 355.426 489.321C354.536 490.618 353.248 491.627 351.562 492.347C349.886 493.057 347.865 493.412 345.497 493.412C343.149 493.412 341.103 493.052 339.361 492.332C337.628 491.613 336.274 490.547 335.298 489.136C334.332 487.716 333.826 485.959 333.778 483.866H339.73C339.796 484.842 340.076 485.656 340.568 486.31C341.07 486.954 341.738 487.441 342.571 487.773C343.414 488.095 344.366 488.256 345.426 488.256C346.468 488.256 347.372 488.104 348.139 487.801C348.916 487.498 349.517 487.077 349.943 486.537C350.369 485.997 350.582 485.377 350.582 484.676C350.582 484.023 350.388 483.473 350 483.028C349.621 482.583 349.063 482.205 348.324 481.892C347.595 481.58 346.7 481.295 345.639 481.04L342.472 480.244C340.019 479.648 338.082 478.715 336.662 477.446C335.241 476.177 334.536 474.468 334.545 472.318C334.536 470.557 335.005 469.018 335.952 467.702C336.908 466.385 338.22 465.358 339.886 464.619C341.553 463.881 343.447 463.511 345.568 463.511C347.727 463.511 349.612 463.881 351.222 464.619C352.841 465.358 354.1 466.385 355 467.702C355.9 469.018 356.364 470.543 356.392 472.276H350.497ZM360.927 493V463.909H367.077V487.929H379.549V493H360.927ZM378.881 468.98V463.909H402.773V468.98H393.867V493H387.788V468.98H378.881Z"
          fill="white"
        />
        <path
          d="M322.5 187H232.5C220.012 187 210 197.125 210 209.5V389.5C210 401.988 220.012 412 232.5 412H367.5C379.988 412 390 401.988 390 389.5V254.5L322.5 187ZM367.5 389.5H232.5V209.5H311.25V265.75H367.5V389.5ZM272.325 340.562L295.838 364.075L281.438 378.25L243.75 340.562L281.438 302.875L295.838 317.05L272.325 340.562ZM356.25 340.562L318.562 378.25L304.275 364.075L327.788 340.562L304.275 317.05L318.562 302.875L356.25 340.562Z"
          fill="white"
        />
      </svg>

      <WorkerLine model={model} />
      {components}
      {isClicked && (
        <FastXSLTMediatorProperty modalOpen={open} modalClose={handleCancelClick} />
      )}
    </>
  );
}
